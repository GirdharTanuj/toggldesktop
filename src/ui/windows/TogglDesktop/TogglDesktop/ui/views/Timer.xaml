<UserControl x:Class="TogglDesktop.Timer"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:toggl="clr-namespace:TogglDesktop"
             mc:Ignorable="d" 
             d:DesignWidth="500" MinWidth="300" Focusable="True"
             Style="{StaticResource Timer}">
    <UserControl.Resources>
        <Style x:Key="Toggl.StartStopButton" TargetType="{x:Type ToggleButton}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Grid>
                            <Canvas Name="StartButton"
                                    Width="36"
                                    Height="36">
                                <Path Fill="{DynamicResource Toggl.AccentBrush}" Data="M 18 0 C 27.941406 0 36 8.058594 36 18 C 36 27.941406 27.941406 36 18 36 C 8.058594 36 0 27.941406 0 18 C 0 8.058594 8.058594 0 18 0 Z M 18 0 "/>
                                <Path Fill="White" Data="M 13 12.394531 C 13 11.074219 13.941406 10.539062 15.082031 11.1875 L 24.917969 16.808594 C 26.070312 17.46875 26.058594 18.535156 24.917969 19.1875 L 15.082031 24.8125 C 13.933594 25.46875 13 24.925781 13 23.605469 Z M 13 12.394531 "/>
                            </Canvas>
                            <Canvas Name="StopButton"
                                    Width="36"
                                    Height="36"
                                    Visibility="Collapsed">
                                <Path Fill="{DynamicResource Toggl.ValidationErrorBackground}" Data="M0 18c0 9.943 8.059 18 18 18 9.942 0 18-8.057 18-18S27.942 0 18 0C8.06 0 0 8.057 0 18z"/>
                                <Path Fill="White" Data="M24 22.504C24 23.33 23.32 24 22.504 24h-9.008C12.67 24 12 23.32 12 22.504v-9.008c0-.826.68-1.496 1.496-1.496h9.008c.826 0 1.496.68 1.496 1.496v9.008z"/>
                            </Canvas>
                            <Ellipse Name="OverlayEllipse"
                                     Width="36"
                                     Height="36"
                                     Fill="Transparent" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="StopButton" Property="Visibility" Value="Visible" />
                                <Setter TargetName="StartButton" Property="Visibility" Value="Collapsed" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="OverlayEllipse" Property="Fill" Value="#0D000000" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="OverlayEllipse" Property="Fill" Value="#19000000" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid Name="manualPanel" x:FieldModifier="private" Visibility="Collapsed">
            <Button Name="manualAddButton" x:FieldModifier="private"
                    Style="{DynamicResource Toggl.AccentButton}"
                    Height="36"
                    Padding="10 7 10 10"
                    Margin="17 17 16 15"
                    Click="onManualAddButtonClick">
                <StackPanel Orientation="Horizontal">
                    <Canvas Width="24" Height="24" Margin="4 -2 4 4">
                        <Path Fill="Transparent" Data="M0 0h24v24H0z"/>
                        <Path Fill="White" Data="M12.5 6v5.5H18v1h-5.5V18h-1v-5.5H6v-1h5.5V6h1z" />
                    </Canvas>
                    <TextBlock Text="Add Time Entry" />
                </StackPanel>
            </Button>
        </Grid>
        <Grid Name="timerPanel" x:FieldModifier="private"  Visibility="Visible"
    MouseLeftButtonDown="onGridMouseDown" IsHitTestVisible="True" Background="Transparent" KeyDown="onGridKeyDown">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition />
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- description and project-->
            <Grid Grid.Column="1"
                Margin="-20, 4, 0, 4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition Name="projectGridRow" x:FieldModifier="private"/>
                </Grid.RowDefinitions>

                <Button Name="cancelProjectSelectionButton" x:FieldModifier="private"
                        Style="{StaticResource TimerProjectRemoveButton}"
                        Grid.Row="1" Grid.Column="0"
                        Width="16" Height="16" Padding="2"
                        IsTabStop="False" Click="cancelProjectSelectionButtonClick"/>

                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" MouseLeftButtonDown="onProjectLabelMouseDown">

                    <TextBlock Name="projectLabel" x:FieldModifier="private"
                               Text="Project"/>
                    <TextBlock Foreground="#dddddd"
                               Visibility="{Binding ElementName=clientLabel, Path=Visibility}"
                               Text="·" />
                    <TextBlock Name="clientLabel" x:FieldModifier="private"
                            Foreground="#dddddd" Text="Client"/>
                    
                </StackPanel>

                <Grid Grid.Row="0" Grid.Column="1" MouseLeftButtonDown="onDescriptionLabelMouseDown"
                      Name="taskDescriptionGrid" x:FieldModifier="private">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Name="taskLabel" x:FieldModifier="private"
                            Foreground="#bbbbbb" Text="Task -" />

                    <!-- description placeholder/display -->
                    <TextBlock Grid.Column="1" Name="descriptionLabel" x:FieldModifier="private"
                               Text="What are you doing?">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock" BasedOn="{StaticResource TimerTextBlockBase}">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding ElementName=descriptionTextBox, Path=Text}" Value=""/>
                                            <Condition Binding="{Binding ElementName=descriptionTextBox, Path=IsKeyboardFocused}" Value="False"/>
                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </MultiDataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <toggl:ExtendedTextBox Grid.Column="1"  x:Name="descriptionTextBox" x:FieldModifier="private"
                                           TextChanged="onDescriptionTextBoxTextChanged"
                                Margin="-2, 0, 6, 0"/>

                </Grid>

                <toggl:AutoCompletionPopup Grid.Row="0" Grid.Column="1"  x:Name="descriptionAutoComplete" x:FieldModifier="private"
                                TextBox="{Binding ElementName=descriptionTextBox}"
                                Target="{Binding ElementName=taskDescriptionGrid}"
                                EmptyText="No previous entries found." StaysOpen="False"
                                ConfirmCompletion="descriptionAutoComplete_OnConfirmCompletion"/>
            </Grid>

            <!-- billable, tags -->
            <StackPanel Grid.Column="2" Name="iconPanel" x:FieldModifier="private"
                    Orientation="Horizontal" HorizontalAlignment="Right">

                <Image Name="tagsIcon" Source="/TogglDesktop;component/Resources/icon-tags.png"
                    Stretch="UniformToFill" Margin="3, 0, 3, 0" Height="16"/>
                <Image Name="billabeIcon" Source="/TogglDesktop;component/Resources/icon-billable.png"
                    Stretch="UniformToFill" Margin="3, 0, 3, 0" Height="20"/>

            </StackPanel>

            <!-- time placeholder/display -->
            <Grid Grid.Column="3" VerticalAlignment="Center"
                  Name="timeDisplayGrid" x:FieldModifier="private"
                  Visibility="Collapsed">
                <TextBlock Name="durationLabelRight" x:FieldModifier="private"
                           Style="{DynamicResource Toggl.BaseText}"
                           Margin="8"
                           MouseLeftButtonDown="onTimeLabelMouseDown" Text="00:00:00" />
            </Grid>

            <!-- start/stop button -->
            <ToggleButton Grid.Column="4" Name="startStopButton" x:FieldModifier="private"
                          Style="{StaticResource Toggl.StartStopButton}"
                          Margin="0 16 12 16"
                          Click="startStopButtonOnClick"/>
        </Grid>
    </Grid>
</UserControl>
